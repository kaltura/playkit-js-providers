!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ott=t():(e.playkit=e.playkit||{},e.playkit.providers=e.playkit.providers||{},e.playkit.providers.ott=t())}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=18)}([function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(1);function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function e(t,n,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};o(this,e),this.severity=t,this.category=n,this.code=i,this.data=a,Object(r.c)("Error")!==r.a.OFF&&e._logger.error("Category:".concat(n," | Code:").concat(i," |"),a)};i(a,"Severity",{RECOVERABLE:1,CRITICAL:2}),i(a,"Category",{NETWORK:1,SERVICE:2,PROVIDER:3}),i(a,"Code",{UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,BAD_SERVER_RESPONSE:1005,MULTIREQUEST_API_ERROR:1006,API_RESPONSE_MISMATCH:1007,ERROR:2e3,BLOCK_ACTION:2001,MEDIA_STATUS_NOT_READY:2002,MISSING_MANDATORY_PARAMS:3e3,MISSING_PLAY_SOURCE:3001,METHOD_NOT_IMPLEMENTED:3002}),i(a,"_logger",Object(r.b)("Error"))},function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return s})),n.d(t,"e",(function(){return u})),n.d(t,"d",(function(){return i}));var r=n(4),o={DEBUG:r.DEBUG,INFO:r.INFO,TIME:r.TIME,WARN:r.WARN,ERROR:r.ERROR,OFF:r.OFF};function i(e){r.setHandler((function(t,n){return e(t,n)}))}function a(e){return e?r.get(e):r}function s(e){return a(e).getLevel()}function u(e,t){a(t).setLevel(e)}r.useDefaults({defaultLevel:r.ERROR}),t.b=a},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(8);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i,a,s,u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.metadata=new Map,this.sources=new r.a,this.type=e.Type.UNKNOWN}var t,n,i;return t=e,(n=[{key:"toJSON",value:function(){return{id:this.id,name:this.name,sources:this.sources.toJSON(),duration:this.duration,dvrStatus:this.dvrStatus,status:this.status,metadata:this.metadata,type:this.type,poster:this.poster,assetReferenceType:this.assetReferenceType}}}])&&o(t.prototype,n),i&&o(t,i),e}();s={VOD:"Vod",LIVE:"Live",IMAGE:"Image",AUDIO:"Audio",UNKNOWN:"Unknown"},(a="Type")in(i=u)?Object.defineProperty(i,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[a]=s},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(0);function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Map;o(this,e),a(this,"retryConfig",{async:!0,timeout:0,maxAttempts:4}),a(this,"_attemptCounter",1),this.headers=t}var t,n,s;return t=e,(n=[{key:"getUrl",value:function(e){return e+"/service/"+this.service+(this.action?"/action/"+this.action:"")}},{key:"doHttpRequest",value:function(){var e=this,t=new Promise((function(t,n){e._requestPromise={resolve:t,reject:n}}));return this.url||this._requestPromise.reject(new r.a(r.a.Severity.CRITICAL,r.a.Category.NETWORK,r.a.Code.MALFORMED_DATA_URI,{url:this.url})),this._createXHR(),t}},{key:"_createXHR",value:function(){var e=this,t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===t.readyState&&200===t.status)try{var n=JSON.parse(t.responseText);return e.responseHeaders=e._getResponseHeaders(t),e._requestPromise.resolve(n)}catch(n){e._requestPromise.reject(e._createError(t,r.a.Code.BAD_SERVER_RESPONSE,{text:t.responseText}))}},t.open(this.method,this.url,this.retryConfig.async),this.retryConfig.async&&this.retryConfig.timeout&&(t.timeout=this.retryConfig.timeout);var n=performance.now();t.ontimeout=function(){e._handleError(t,r.a.Code.TIMEOUT,{timeout:(performance.now()-n)/1e3,statusText:t.statusText})},t.onerror=t.onabort=function(){e._handleError(t,r.a.Code.HTTP_ERROR,{text:t.responseText,statusText:t.statusText})},this.headers.forEach((function(e,n){t.setRequestHeader(n,e)})),t.send(this.params)}},{key:"_getResponseHeaders",value:function(e){return e.getAllResponseHeaders().split("\n").filter((function(e){return 0===e.toLowerCase().indexOf("x-")}))}},{key:"_handleError",value:function(e,t,n){var r=this._createError(e,t,n);if(e.onreadystatechange=function(){},e.onerror=function(){},e.ontimeout=function(){},e.onabort=function(){},!(this.retryConfig.maxAttempts&&this._attemptCounter<this.retryConfig.maxAttempts))return this._requestPromise.reject(r);this._attemptCounter++,this._createXHR()}},{key:"_createError",value:function(e,t,n){return Object.assign(n,{url:this.url,headers:this._getResponseHeaders(e),attempt:this._attemptCounter}),new r.a(r.a.Severity.CRITICAL,r.a.Category.NETWORK,t,n)}}])&&i(t.prototype,n),s&&i(t,s),e}()},function(e,t,n){var r,o;
/*!
 * js-logger - http://github.com/jonnyreeves/js-logger
 * Jonny Reeves, http://jonnyreeves.co.uk/
 * js-logger may be freely distributed under the MIT license.
 */!function(i){"use strict";var a,s={};s.VERSION="1.6.0";var u={},c=function(e,t){return function(){return t.apply(e,arguments)}},f=function(){var e,t,n=arguments,r=n[0];for(t=1;t<n.length;t++)for(e in n[t])!(e in r)&&n[t].hasOwnProperty(e)&&(r[e]=n[t][e]);return r},l=function(e,t){return{value:e,name:t}};s.TRACE=l(1,"TRACE"),s.DEBUG=l(2,"DEBUG"),s.INFO=l(3,"INFO"),s.TIME=l(4,"TIME"),s.WARN=l(5,"WARN"),s.ERROR=l(8,"ERROR"),s.OFF=l(99,"OFF");var p=function(e){this.context=e,this.setLevel(e.filterLevel),this.log=this.info};p.prototype={setLevel:function(e){e&&"value"in e&&(this.context.filterLevel=e)},getLevel:function(){return this.context.filterLevel},enabledFor:function(e){var t=this.context.filterLevel;return e.value>=t.value},trace:function(){this.invoke(s.TRACE,arguments)},debug:function(){this.invoke(s.DEBUG,arguments)},info:function(){this.invoke(s.INFO,arguments)},warn:function(){this.invoke(s.WARN,arguments)},error:function(){this.invoke(s.ERROR,arguments)},time:function(e){"string"==typeof e&&e.length>0&&this.invoke(s.TIME,[e,"start"])},timeEnd:function(e){"string"==typeof e&&e.length>0&&this.invoke(s.TIME,[e,"end"])},invoke:function(e,t){a&&this.enabledFor(e)&&a(t,f({level:e},this.context))}};var y,h=new p({filterLevel:s.OFF});(y=s).enabledFor=c(h,h.enabledFor),y.trace=c(h,h.trace),y.debug=c(h,h.debug),y.time=c(h,h.time),y.timeEnd=c(h,h.timeEnd),y.info=c(h,h.info),y.warn=c(h,h.warn),y.error=c(h,h.error),y.log=y.info,s.setHandler=function(e){a=e},s.setLevel=function(e){for(var t in h.setLevel(e),u)u.hasOwnProperty(t)&&u[t].setLevel(e)},s.getLevel=function(){return h.getLevel()},s.get=function(e){return u[e]||(u[e]=new p(f({name:e},h.context)))},s.createDefaultHandler=function(e){(e=e||{}).formatter=e.formatter||function(e,t){t.name&&e.unshift("["+t.name+"]")};var t={},n=function(e,t){Function.prototype.apply.call(e,console,t)};return"undefined"==typeof console?function(){}:function(r,o){r=Array.prototype.slice.call(r);var i,a=console.log;o.level===s.TIME?(i=(o.name?"["+o.name+"] ":"")+r[0],"start"===r[1]?console.time?console.time(i):t[i]=(new Date).getTime():console.timeEnd?console.timeEnd(i):n(a,[i+": "+((new Date).getTime()-t[i])+"ms"])):(o.level===s.WARN&&console.warn?a=console.warn:o.level===s.ERROR&&console.error?a=console.error:o.level===s.INFO&&console.info?a=console.info:o.level===s.DEBUG&&console.debug?a=console.debug:o.level===s.TRACE&&console.trace&&(a=console.trace),e.formatter(r,o),n(a,r))}},s.useDefaults=function(e){s.setLevel(e&&e.defaultLevel||s.DEBUG),s.setHandler(s.createDefaultHandler(e))},void 0===(o="function"==typeof(r=s)?r.call(t,n,t,e):r)||(e.exports=o)}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return i}));var r={DASH:{name:"dash",mimeType:"application/dash+xml",pathExt:"mpd"},HLS:{name:"hls",mimeType:"application/x-mpegURL",pathExt:"m3u8"},WVM:{name:"wvm",mimeType:"video/wvm",pathExt:"wvm"},MP4:{name:"mp4",mimeType:"video/mp4",pathExt:"mp4"},MP3:{name:"mp3",mimeType:"audio/mpeg",pathExt:"mp3"}},o=new Map([["mpegdash",r.DASH],["applehttp",r.HLS],["url",r.MP4]]);function i(e){var t=o.get(e);return!!t&&t.name===r.MP4.name}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",(function(){return o}));var o=function e(t){var n,o,a;r(this,e),a=!1,(o="hasError")in(n=this)?Object.defineProperty(n,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[o]=a,"KalturaAPIException"===t.objectType?(this.hasError=!0,this.error=new i(t.code,t.message)):t.error&&"KalturaAPIException"===t.error.objectType?(this.hasError=!0,this.error=new i(t.error.code,t.error.message)):this.data=t},i=function e(t,n){r(this,e),this.code=t,this.message=n}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r,o,i,a=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scheme=t.scheme,this.licenseURL=t.licenseURL,this.certificate=t.certificate};i={"drm.PLAYREADY_CENC":"com.microsoft.playready","drm.WIDEVINE_CENC":"com.widevine.alpha","fairplay.FAIRPLAY":"com.apple.fairplay",WIDEVINE_CENC:"com.widevine.alpha",PLAYREADY_CENC:"com.microsoft.playready",FAIRPLAY:"com.apple.fairplay"},(o="Scheme")in(r=a)?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));n(9);var r=n(5);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.progressive=[],this.dash=[],this.hls=[]}var t,n,i;return t=e,(n=[{key:"map",value:function(e,t){if(t)switch(t.name){case r.a.MP4.name:this.progressive.push(e);break;case r.a.DASH.name:this.dash.push(e);break;case r.a.HLS.name:this.hls.push(e)}}},{key:"toJSON",value:function(){var e={progressive:[],dash:[],hls:[]};return this.progressive.forEach((function(t){return e.progressive.push(t.toJSON())})),this.hls.forEach((function(t){return e.hls.push(t.toJSON())})),this.dash.forEach((function(t){return e.dash.push(t.toJSON())})),e}}])&&o(t.prototype,n),i&&o(t,i),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));n(13);function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,(n=[{key:"toJSON",value:function(){var e={id:this.id,url:this.url,mimetype:this.mimetype};return this.bandwidth&&(e.bandwidth=this.bandwidth),this.width&&(e.width=this.width),this.height&&(e.height=this.height),this.label&&(e.label=this.label),this.drmData&&this.drmData.length>0&&(e.drmData=[],this.drmData.forEach((function(t){Array.isArray(e.drmData)&&e.drmData.push(t.toJSON())}))),e}}])&&r(t.prototype,n),o&&r(t,o),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));n(11);var r=n(0);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"_loadersResponseMap",new Map),i(this,"_loaders",new Map),this._networkRetryConfig=t}var t,n,a;return t=e,(n=[{key:"add",value:function(e,t){var n=this,r=new e(t);if(r.isValid()){this._loaders.set(e.id,r);var o=this._multiRequest.requests.length,i=r.requests;this._multiRequest.retryConfig=this._networkRetryConfig,i.forEach((function(e){n._multiRequest.add(e)}));var a=Array.from(new Array(i.length),(function(e,t){return t+o}));this._loadersResponseMap.set(e.id,a)}}},{key:"fetchData",value:function(){var e=this;return new Promise((function(t,n){e._multiRequest.execute().then((function(o){e._multiResponse=o.response,e.prepareData(o.response).success?t(e._loaders):n(new r.a(r.a.Severity.CRITICAL,r.a.Category.NETWORK,r.a.Code.API_RESPONSE_MISMATCH,{headers:o.headers}))}),(function(e){n(e)}))}))}},{key:"prepareData",value:function(e){var t=this;return this._loaders.forEach((function(n,r){var o=t._loadersResponseMap.get(r);try{o&&o.length>0&&(n.response=e.results.slice(o[0],o[o.length-1]+1))}catch(e){return{success:!1,error:e}}})),{success:!0,data:this._loaders}}}])&&o(t.prototype,n),a&&o(t,a),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var r=n(3),o=n(1),i=n(6),a=n(0);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h(e);if(t){var o=h(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p(this,n)}}function p(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?y(e):t}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(i,e);var t,n,r,o=l(i);function i(){var e;u(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return d(y(e=o.call.apply(o,[this].concat(n))),"requests",[]),e}return t=i,(n=[{key:"add",value:function(e){this.requests.push(e);var t={},n={service:e.service,action:e.action};return Object.assign(t,d({},this.requests.length,Object.assign(n,e.params))),Object.assign(t,this.params),this.params=t,this}},{key:"execute",value:function(){var e=this;return new Promise((function(t,n){try{e.params=JSON.stringify(e.params)}catch(t){i._logger.error("".concat(t.message)),n(new a.a(a.a.Severity.CRITICAL,a.a.Category.PROVIDER,a.a.Code.FAILED_PARSING_REQUEST,{error:t,params:e.params}))}e.doHttpRequest().then((function(r){var o=new m(r);o.success?t({headers:e.responseHeaders,response:o}):n(new a.a(a.a.Severity.CRITICAL,a.a.Category.NETWORK,a.a.Code.MULTIREQUEST_API_ERROR,{url:e.url,headers:e.responseHeaders,results:o.results}))}),(function(e){n(e)}))}))}}])&&c(t.prototype,n),r&&c(t,r),i}(r.a);d(v,"_logger",Object(o.b)("MultiRequestBuilder"));var m=function e(t){var n=this;u(this,e),d(this,"results",[]),this.success=!0,(t.result?t.result:t).forEach((function(t){var r=new i.a(t);if(n.results.push(r),r.hasError)return e._logger.error("Service returned an error with error code: ".concat(r.error.code," and message: ").concat(r.error.message,".")),void(n.success=!1)}))};d(m,"_logger",Object(o.b)("MultiRequestResult"))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.message=t.message,this.code=t.code}},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",(function(){return o}));var o=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.licenseUrl=t,this.scheme=n,r&&(this.certificate=r)}var t,n,o;return t=e,(n=[{key:"toJSON",value:function(){var e={licenseUrl:this.licenseUrl,scheme:this.scheme};return this.certificate&&(e.certificate=this.certificate),e}}])&&r(t.prototype,n),o&&r(t,o),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(1),o=(n(10),n(0));function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}var s=function(){function e(t,n){var o,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a={async:!0,timeout:0,maxAttempts:4},(i="_networkRetryConfig")in(o=this)?Object.defineProperty(o,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[i]=a,this._partnerId=t.partnerId,this._widgetId=t.widgetId,this._uiConfId=t.uiConfId,this._isAnonymous=!t.ks,this._ks=t.ks||"",this._playerVersion=n,t.log&&t.log.level&&this.LogLevel[t.log.level]&&Object(r.e)(this.LogLevel[t.log.level]),t.log&&"function"==typeof t.log.handler&&Object(r.d)(t.log.handler)}return a(e,[{key:"partnerId",get:function(){return this._partnerId}},{key:"widgetId",get:function(){return this._widgetId||this.defaultWidgetId}},{key:"defaultWidgetId",get:function(){return"_"+this._partnerId}},{key:"uiConfId",get:function(){return this._uiConfId}},{key:"ks",get:function(){return this._ks},set:function(e){this._ks=e}},{key:"playerVersion",get:function(){return this._playerVersion}},{key:"isAnonymous",get:function(){return this._isAnonymous}}]),a(e,[{key:"getMediaConfig",value:function(e){return Promise.reject(new o.a(o.a.Severity.CRITICAL,o.a.Category.PROVIDER,o.a.Code.METHOD_NOT_IMPLEMENTED,{message:"getMediaConfig method must be implement by the derived class"}))}},{key:"getPlaylistConfig",value:function(e){return Promise.reject(new o.a(o.a.Severity.CRITICAL,o.a.Category.PROVIDER,o.a.Code.METHOD_NOT_IMPLEMENTED,{message:"The provider does not support loading playlist by id"}))}},{key:"getEntryListConfig",value:function(e){return Promise.reject(new o.a(o.a.Severity.CRITICAL,o.a.Category.PROVIDER,o.a.Code.METHOD_NOT_IMPLEMENTED,{message:"The provider does not support loading entry list"}))}},{key:"_verifyHasSources",value:function(e){if(0===e.hls.concat(e.dash,e.progressive).length)throw new o.a(o.a.Severity.CRITICAL,o.a.Category.SERVICE,o.a.Code.MISSING_PLAY_SOURCE,{action:"",messages:"No play source for entry id: ".concat(e.id)})}},{key:"getLogLevel",value:function(e){return Object(r.c)(e)}},{key:"setLogLevel",value:function(e,t){Object(r.e)(e,t)}},{key:"LogLevel",get:function(){return r.a}}]),e}()},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.d(t,"a",(function(){return o}));var o=function e(t){var n;return Array.isArray(t)?(n=t.length>0?t.slice(0):[]).forEach((function(t,o){("object"===r(t)&&t!=={}||Array.isArray(t)&&t.length>0)&&(n[o]=e(t))})):"object"===r(t)?(n=Object.assign({},t),Object.keys(n).forEach((function(t){("object"===r(n[t])&&n[t]!=={}||Array.isArray(n[t])&&n[t].length>0)&&(n[t]=e(n[t]))}))):n=t,n}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n(2);var r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.items=[]}},,function(e,t,n){"use strict";n.r(t),n.d(t,"Provider",(function(){return qe})),n.d(t,"ContextType",(function(){return Ke})),n.d(t,"MediaType",(function(){return We})),n.d(t,"NAME",(function(){return He})),n.d(t,"VERSION",(function(){return Ve}));var r=n(14),o=n(1),i=n(15);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s={serviceParams:{apiVersion:"5.2.6"}},u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"set",value:function(e){e&&Object.assign(s,e)}},{key:"get",value:function(){return Object(i.a)(s)}}],(n=null)&&a(t.prototype,n),r&&a(t,r),e}(),c=n(10),f=n(11);function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"getMultiRequest",value:function(e,t){var n=u.get(),r=n.serviceParams;e&&Object.assign(r,{ks:e}),t&&Object.assign(r,{partnerId:t});var o=new Map;o.set("Content-Type","application/json");var i=new f.a(o);return i.method="POST",i.service="multirequest",i.url=i.getUrl(n.serviceUrl),i.params=r,i}}],(n=null)&&l(t.prototype,n),r&&l(t,r),e}();function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=b(e);if(t){var o=b(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return m(this,n)}}function m(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(n,e);var t=v(n);function n(e){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;return h(this,n),(r=t.call(this,i))._multiRequest=p.getMultiRequest(o,e),r}return n}(c.a),_=n(3);function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function T(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var o=P(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return C(this,n)}}function C(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var k=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(i,e);var t,n,r,o=T(i);function i(){return E(this,i),o.apply(this,arguments)}return t=i,r=[{key:"anonymousLogin",value:function(e,t,n){var r=new Map;r.set("Content-Type","application/json");var o=new _.a(r);o.service="ottuser",o.action="anonymousLogin",o.method="POST",o.url=o.getUrl(e);var i={partnerId:t};return n&&Object.assign(i,{udid:n}),o.params=i,o}}],(n=null)&&R(t.prototype,n),r&&R(t,r),i}(p);function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e,t,n){return t&&S(e.prototype,t),n&&S(e,n),e}var A=function(){function e(t){var n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o={},(r="_response")in(n=this)?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,this.requests=this.buildRequests(t),this._partnerId=t.partnerId}return I(e,null,[{key:"id",get:function(){return"session"}}]),I(e,[{key:"buildRequests",value:function(e){var t=u.get(),n=[];return n.push(k.anonymousLogin(t.serviceUrl,e.partnerId,e.udid)),n}},{key:"isValid",value:function(){return!!this._partnerId}},{key:"requests",set:function(e){this._requests=e},get:function(){return this._requests}},{key:"response",set:function(e){this._response.ks=e[0].data.ks},get:function(){return this._response.ks}}]),e}();function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=U(e);if(t){var o=U(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return x(this,n)}}function x(e,t){return!t||"object"!==j(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var B=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}(i,e);var t,n,r,o=N(i);function i(){return D(this,i),o.apply(this,arguments)}return t=i,r=[{key:"getPlaybackContext",value:function(e,t,n,r,o){var i=new Map;i.set("Content-Type","application/json");var a=new _.a(i);a.service="asset",a.action="getPlaybackContext",a.method="POST",a.url=a.getUrl(e);var s={objectType:"KalturaPlaybackContextOptions"};return Object.assign(s,o),a.params={assetId:n,assetType:r,contextDataParams:s,ks:t},a}},{key:"get",value:function(e,t,n,r){var o=new Map;o.set("Content-Type","application/json");var i=new _.a(o);return i.service="asset",i.action="get",i.method="POST",i.url=i.getUrl(e),i.params={id:n,assetReferenceType:r,ks:t},i}}],(n=null)&&L(t.prototype,n),r&&L(t,r),i}(p),F=n(6),q=n(12);var H,V,K,W=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=t.type};K={BLOCK:"BLOCK",START_DATE_OFFSET:"START_DATE_OFFSET",END_DATE_OFFSET:"END_DATE_OFFSET",USER_BLOCK:"USER_BLOCK",ALLOW_PLAYBACK:"ALLOW_PLAYBACK",BLOCK_PLAYBACK:"BLOCK_PLAYBACK",APPLY_DISCOUNT_MODULE:"APPLY_DISCOUNT_MODULE"},(V="Type")in(H=W)?Object.defineProperty(H,V,{value:K,enumerable:!0,configurable:!0,writable:!0}):H[V]=K;var Y=n(7);function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var J=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(this,"drm",[]),this.format=t.format,this.adsPolicy=t.adsPolicy,this.adsParam=t.adsParam,this.duration=t.duration,this.url=t.url,this.type=t.type,this.fileId=t.id,this.protocols=t.protocols,t.drm&&t.drm.map((function(e){return n.drm.push(new Y.a(e))}))}var t,n,r;return t=e,(n=[{key:"hasDrmData",value:function(){return this.drm&&this.drm.length>0}},{key:"getProtocol",value:function(e){var t="";if(this.protocols&&this.protocols.length>0)this.protocols.split(",").forEach((function(n){n===e&&(t=n)}));else if("http"===e)return e;return t}}])&&G(t.prototype,n),r&&G(t,r),e}();var X=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.streamertype=t.streamertype,this.url=t.url};function Q(e){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Z(e,t){return(Z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ne(e);if(t){var o=ne(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ee(this,n)}}function ee(e,t){return!t||"object"!==Q(t)&&"function"!=typeof t?te(e):t}function te(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ne(e){return(ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(X,"StreamerType",{HLS:"hls",DASH:"dash",PROGRESSIVE:"progressive"});var oe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Z(e,t)}(i,e);var t,n,r,o=$(i);function i(e){var t;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),re(te(t=o.call(this,e)),"sources",[]),re(te(t),"actions",[]),re(te(t),"messages",[]),re(te(t),"plugins",[]),!t.hasError){var n=e.messages;n&&n.map((function(e){return t.messages.push(new q.a(e))}));var r=e.actions;r&&r.map((function(e){return t.actions.push(new W(e))}));var a=e.sources;a&&a.map((function(e){return t.sources.push(new J(e))}));var s=e.plugins;s&&s.map((function(e){return t.plugins.push(new X(e))}))}return t}return t=i,(n=[{key:"hasBlockAction",value:function(){return void 0!==this.getBlockAction()}},{key:"getBlockAction",value:function(){return this.actions.find((function(e){return e.type===W.Type.BLOCK}))}},{key:"getErrorMessages",value:function(){return this.messages}}])&&z(t.prototype,n),r&&z(t,r),i}(F.a);function ie(e){return(ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function se(e,t){return(se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=le(e);if(t){var o=le(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ce(this,n)}}function ce(e,t){return!t||"object"!==ie(t)&&"function"!=typeof t?fe(e):t}function fe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function le(e){return(le=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}re(oe,"Type",{TRAILER:"TRAILER",CATCHUP:"CATCHUP",START_OVER:"START_OVER",PLAYBACK:"PLAYBACK"});var ye=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&se(e,t)}(i,e);var t,n,r,o=ue(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),pe(fe(t=o.call(this,e)),"name",""),pe(fe(t),"description",""),pe(fe(t),"tags",[]),pe(fe(t),"metas",[]),pe(fe(t),"pictures",[]),t.hasError||(t.id=e.id,t.name=e.name,t.description=e.description,t.metas=t._formatTagsMetas(e.metas),t.tags=t._formatTagsMetas(e.tags),t.pictures=e.images),t}return t=i,(n=[{key:"_formatTagsMetas",value:function(e){var t=[];return Object.keys(e).forEach((function(n){if(e[n].objects){var r="";e[n].objects.forEach((function(e){r+=e.value+"|"})),t.push({key:n,value:r})}else t.push({key:n,value:e[n].value})})),t}}])&&ae(t.prototype,n),r&&ae(t,r),i}(F.a);function he(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function de(e,t,n){return t&&he(e.prototype,t),n&&he(e,n),e}pe(ye,"Type",{MEDIA:"media",RECORDING:"recording",EPG:"epg"}),pe(ye,"AssetReferenceType",{MEDIA:"media",EPG_INTERNAL:"epg_internal",EPG_EXTERNAL:"epg_external",NPVR:"nPVR"});var ve=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(this,"_response",{}),this.requests=this.buildRequests(t),this._entryId=t.entryId}return de(e,null,[{key:"id",get:function(){return"asset"}}]),de(e,[{key:"buildRequests",value:function(e){var t=u.get(),n=[];return n.push(B.get(t.serviceUrl,e.ks,e.entryId,e.assetReferenceType)),n.push(B.getPlaybackContext(t.serviceUrl,e.ks,e.entryId,e.type,e.playbackContext)),n}},{key:"isValid",value:function(){return!!this._entryId}},{key:"requests",set:function(e){this._requests=e},get:function(){return this._requests}},{key:"response",set:function(e){this._response.mediaDataResult=new ye(e[0].data),this._response.playBackContextResult=new oe(e[1].data)},get:function(){return this._response}}]),e}();function me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function be(e,t,n){return t&&me(e.prototype,t),n&&me(e,n),e}var ge=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(this,"_response",{playlistItems:{entries:[]}}),this.requests=this.buildRequests(t),this._entries=t.entries}return be(e,null,[{key:"id",get:function(){return"asset_list"}}]),be(e,[{key:"buildRequests",value:function(e){var t=u.get(),n=[];return e.entries.forEach((function(r){var o=r.assetReferenceType||ye.AssetReferenceType.MEDIA;n.push(B.get(t.serviceUrl,e.ks,r.entryId||r,o))})),n}},{key:"isValid",value:function(){return!(!this._entries||!this._entries.length)}},{key:"requests",set:function(e){this._requests=e},get:function(){return this._requests}},{key:"response",set:function(e){var t=this;e.forEach((function(e){t._response.playlistItems.entries.push({mediaDataResult:new ye(e.data)})}))},get:function(){return this._response}}]),e}(),_e=n(2),Oe=n(13),Ee=n(9),Re=n(8),we=n(16);var Te,Ce,Pe,ke=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t.url},Se=n(5);function Ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var je=(Ae(Pe={},ye.Type.MEDIA,(Ae(Te={},oe.Type.TRAILER,(function(){return{type:_e.a.Type.VOD}})),Ae(Te,oe.Type.PLAYBACK,(function(e){return parseInt(e.externalIds)>0||"KalturaLiveAsset"===e.objectType?{type:_e.a.Type.LIVE,dvrStatus:0}:{type:_e.a.Type.VOD}})),Te)),Ae(Pe,ye.Type.EPG,(Ae(Ce={},oe.Type.CATCHUP,(function(){return{type:_e.a.Type.VOD}})),Ae(Ce,oe.Type.START_OVER,(function(){return{type:_e.a.Type.LIVE,dvrStatus:1}})),Ce)),Ae(Pe,ye.Type.RECORDING,Ae({},oe.Type.PLAYBACK,(function(){return{type:_e.a.Type.VOD}}))),Pe),De=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"getMediaEntry",value:function(t,n){var r=new _e.a;e._fillBaseData(r,t,n);var o=t.playBackContextResult,i=t.mediaDataResult,a=o.sources,s=e._filterSourcesByFormats(a,n.formats);r.sources=e._getParsedSources(s);var u=e._getMediaType(i.data,n.mediaType,n.contextType);return r.type=u.type,r.dvrStatus=u.dvrStatus,r.duration=Math.max.apply(Math,a.map((function(e){return e.duration}))),r}},{key:"getEntryList",value:function(t,n){var r=new we.a;return t.playlistItems.entries.forEach((function(t){var o=new _e.a,i=n.find((function(e){return e.entryId===t.mediaDataResult.id}));e._fillBaseData(o,t,i),r.items.push(o)})),r}},{key:"getBumper",value:function(e){var t=e.playBackContextResult.plugins.find((function(e){return e.streamertype===X.StreamerType.PROGRESSIVE}));if(t)return new ke(t)}},{key:"_fillBaseData",value:function(t,n,r){var o=n.mediaDataResult,i=e.reconstructMetadata(o);return i.description=o.description,i.name=o.name,r&&r.mediaType&&(i.mediaType=r.mediaType),t.metadata=i,t.poster=e._getPoster(o.pictures),t.id=o.id,t}},{key:"reconstructMetadata",value:function(t){return{metas:e.addToMetaObject(t.metas),tags:e.addToMetaObject(t.tags)}}},{key:"addToMetaObject",value:function(e){var t={};return e&&e.forEach((function(e){t[e.key]=e.value})),t}},{key:"_getPoster",value:function(e){if(e&&e.length>0){var t=e[0].url;return/.*\/thumbnail\/.*(?:width|height)\/\d+\/(?:height|width)\/\d+/.test(t)?t:e.map((function(e){return{url:e.url,width:e.width,height:e.height}}))}return""}},{key:"_getMediaType",value:function(e,t,n){var r={type:_e.a.Type.UNKNOWN};return je[t]&&je[t][n]&&(r=je[t][n](e)),r}},{key:"_filterSourcesByFormats",value:function(e,t){return t.length>0&&(e=e.filter((function(e){return t.includes(e.type)}))),e}},{key:"_getParsedSources",value:function(t){var n=new Re.a,r=function(t){var r=e._parseAdaptiveSource(t);if(r){var o=Se.b.get(t.format);n.map(r,o)}};return t&&t.length>0&&(t.filter((function(e){return!Object(Se.c)(e.format)})).forEach(r),t.filter((function(e){return Object(Se.c)(e.format)})).forEach(r)),n}},{key:"_parseAdaptiveSource",value:function(t){var n=new Ee.a;if(t){var r=t.url,o=Se.b.get(t.format);if(o&&(n.mimetype=o.mimeType),!r)return e._logger.error("failed to create play url from source, discarding source: (".concat(t.fileId,"), ").concat(t.format,".")),null;if(n.url=r,n.id=t.fileId+","+t.format,t.hasDrmData()){var i=[];t.drm.forEach((function(e){i.push(new Oe.a(e.licenseURL,Y.a.Scheme[e.scheme],e.certificate))})),n.drmData=i}}return n}},{key:"hasBlockAction",value:function(e){return e.playBackContextResult.hasBlockAction()}},{key:"getBlockAction",value:function(e){return e.playBackContextResult.getBlockAction()}},{key:"getErrorMessages",value:function(e){return e.playBackContextResult.getErrorMessages()}}],(n=null)&&Ie(t.prototype,n),r&&Ie(t,r),e}();Ae(De,"_logger",Object(o.b)("OTTProviderParser"));var Le=n(0);function Me(e){return(Me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function xe(e,t){return(xe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Fe(e);if(t){var o=Fe(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Be(this,n)}}function Be(e,t){return!t||"object"!==Me(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Fe(e){return(Fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var qe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xe(e,t)}(a,e);var t,n,r,i=Ue(a);function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,e,t))._logger=Object(o.b)("OTTProvider"),u.set(e.env),n._networkRetryConfig=Object.assign(n._networkRetryConfig,e.networkRetryParameters),n}return t=a,(n=[{key:"getMediaConfig",value:function(e){var t=this;return e.ks&&(this.ks=e.ks,this._isAnonymous=!1),this._dataLoader=new g(this.partnerId,this.ks,this._networkRetryConfig),new Promise((function(n,r){var o=e.entryId;if(o){var i=t.ks;i||(i="{1:result:ks}",t._dataLoader.add(A,{partnerId:t.partnerId}));var a=e.contextType||oe.Type.PLAYBACK,s=e.mediaType||ye.Type.MEDIA,u=e.assetReferenceType||ye.AssetReferenceType.MEDIA,c={mediaProtocol:e.protocol,assetFileIds:e.fileIds,context:a};t._dataLoader.add(ve,{entryId:o,ks:i,type:s,playbackContext:c,assetReferenceType:u});var f={contextType:a,mediaType:s,formats:e.formats||[]};return t._dataLoader.fetchData().then((function(e){try{n(t._parseDataFromResponse(e,f))}catch(e){r(e)}}),(function(e){r(e)}))}r(new Le.a(Le.a.Severity.CRITICAL,Le.a.Category.PROVIDER,Le.a.Code.MISSING_MANDATORY_PARAMS,{message:"missing entry id"}))}))}},{key:"_parseDataFromResponse",value:function(e,t){this._logger.debug("Data parsing started");var n={session:{isAnonymous:this._isAnonymous,partnerId:this.partnerId},sources:this._getDefaultSourcesObject(),plugins:{}};if(this.uiConfId&&(n.session.uiConfId=this.uiConfId),e){if(e.has(A.id)){var r=e.get(A.id);r&&r.response&&(n.session.ks=r.response)}else n.session.ks=this.ks;if(e.has(ve.id)){var o=e.get(ve.id);if(o&&o.response&&Object.keys(o.response).length){var i=o.response;if(De.hasBlockAction(i))throw new Le.a(Le.a.Severity.CRITICAL,Le.a.Category.SERVICE,Le.a.Code.BLOCK_ACTION,{action:De.getBlockAction(i),messages:De.getErrorMessages(i)});var a=De.getMediaEntry(i,t);Object.assign(n.sources,this._getSourcesObject(a)),this._verifyHasSources(n.sources);var s=De.getBumper(i);s&&Object.assign(n.plugins,{bumper:s})}}}return this._logger.debug("Data parsing finished",n),n}},{key:"getEntryListConfig",value:function(e){var t=this;return e.ks&&(this.ks=e.ks,this._isAnonymous=!1),this._dataLoader=new g(this.partnerId,this.ks,this._networkRetryConfig),new Promise((function(n,r){var o=e.entries;if(o&&o.length){var i=t.ks;i||(i="{1:result:ks}",t._dataLoader.add(A,{partnerId:t.partnerId})),t._dataLoader.add(ge,{entries:o,ks:i}),t._dataLoader.fetchData().then((function(e){n(t._parseEntryListDataFromResponse(e,o))}),(function(e){r(e)}))}else r({success:!1,data:"Missing mandatory parameter"})}))}},{key:"_parseEntryListDataFromResponse",value:function(e,t){var n=this;this._logger.debug("Data parsing started");var r={id:"",metadata:{name:"",description:""},poster:"",items:[]};if(e&&e.has(ge.id)){var o=e.get(ge.id);o&&o.response&&De.getEntryList(o.response,t).items.forEach((function(e){return r.items.push({sources:n._getSourcesObject(e)})}))}return this._logger.debug("Data parsing finished",r),r}},{key:"_getDefaultSourcesObject",value:function(){return{hls:[],dash:[],progressive:[],id:"",duration:0,type:_e.a.Type.UNKNOWN,poster:"",dvr:!1,vr:null,metadata:{name:"",description:"",tags:""}}}},{key:"_getSourcesObject",value:function(e){var t=this._getDefaultSourcesObject(),n=e.sources.toJSON();return t.hls=n.hls,t.dash=n.dash,t.progressive=n.progressive,t.id=e.id,t.duration=e.duration,t.type=e.type,t.dvr=!!e.dvrStatus,t.poster=e.poster,e.metadata&&e.metadata.metas&&"string"==typeof e.metadata.metas.tags&&e.metadata.metas.tags.indexOf("360")>-1&&(t.vr={}),Object.assign(t.metadata,e.metadata),t}}])&&Ne(t.prototype,n),r&&Ne(t,r),a}(r.a),He="playkit-js-providers-ott",Ve="2.21.1",Ke=oe.Type,We=ye.Type}])}));
//# sourceMappingURL=playkit-ott-provider.js.map