!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ovp=e():(t.playkit=t.playkit||{},t.playkit.providers=t.playkit.providers||{},t.playkit.providers.ovp=e())}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=17)}([function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(1);function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var a=function t(e,n,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};o(this,t),this.severity=e,this.category=n,this.code=i,this.data=a,Object(r.c)("Error")!==r.a.OFF&&t._logger.error("Category:".concat(n," | Code:").concat(i," |"),a)};i(a,"Severity",{RECOVERABLE:1,CRITICAL:2}),i(a,"Category",{NETWORK:1,SERVICE:2,PROVIDER:3}),i(a,"Code",{UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,BAD_SERVER_RESPONSE:1005,MULTIREQUEST_API_ERROR:1006,API_RESPONSE_MISMATCH:1007,ERROR:2e3,BLOCK_ACTION:2001,MEDIA_STATUS_NOT_READY:2002,MISSING_MANDATORY_PARAMS:3e3,MISSING_PLAY_SOURCE:3001,METHOD_NOT_IMPLEMENTED:3002}),i(a,"_logger",Object(r.b)("Error"))},function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"c",(function(){return s})),n.d(e,"e",(function(){return u})),n.d(e,"d",(function(){return i}));var r=n(4),o={DEBUG:r.DEBUG,INFO:r.INFO,TIME:r.TIME,WARN:r.WARN,ERROR:r.ERROR,OFF:r.OFF};function i(t){r.setHandler((function(e,n){return t(e,n)}))}function a(t){return t?r.get(t):r}function s(t){return a(t).getLevel()}function u(t,e){a(e).setLevel(t)}r.useDefaults({defaultLevel:r.ERROR}),e.b=a},function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var r=n(8);function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var i,a,s,u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.metadata=new Map,this.sources=new r.a,this.type=t.Type.UNKNOWN}var e,n,i;return e=t,(n=[{key:"toJSON",value:function(){return{id:this.id,name:this.name,sources:this.sources.toJSON(),duration:this.duration,dvrStatus:this.dvrStatus,status:this.status,metadata:this.metadata,type:this.type,poster:this.poster,assetReferenceType:this.assetReferenceType}}}])&&o(e.prototype,n),i&&o(e,i),t}();s={VOD:"Vod",LIVE:"Live",IMAGE:"Image",AUDIO:"Audio",UNKNOWN:"Unknown"},(a="Type")in(i=u)?Object.defineProperty(i,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[a]=s},function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var r=n(0);function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var s=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Map;o(this,t),a(this,"retryConfig",{}),a(this,"_attemptCounter",1),this.headers=e}var e,n,s;return e=t,(n=[{key:"getUrl",value:function(t){return t+"/service/"+this.service+(this.action?"/action/"+this.action:"")}},{key:"doHttpRequest",value:function(){var t=this,e=new Promise((function(e,n){t._requestPromise={resolve:e,reject:n}}));return this.url||this._requestPromise.reject(new r.a(r.a.Severity.CRITICAL,r.a.Category.NETWORK,r.a.Code.MALFORMED_DATA_URI,{url:this.url})),this._createXHR(),e}},{key:"_createXHR",value:function(){var t=this,e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===e.readyState&&200===e.status)try{var n=JSON.parse(e.responseText);return t.responseHeaders=t._getResponseHeaders(e),t._requestPromise.resolve(n)}catch(n){t._requestPromise.reject(t._createError(e,r.a.Code.BAD_SERVER_RESPONSE,{text:e.responseText}))}},e.open(this.method,this.url,this.retryConfig&&this.retryConfig.async),this.retryConfig&&this.retryConfig.async&&this.retryConfig.timeout&&(e.timeout=this.retryConfig.timeout);var n=performance.now();e.ontimeout=function(){t._handleError(e,r.a.Code.TIMEOUT,{timeout:(performance.now()-n)/1e3,statusText:e.statusText})},e.onerror=e.onabort=function(){t._handleError(e,r.a.Code.HTTP_ERROR,{text:e.responseText,statusText:e.statusText})},this.headers.forEach((function(t,n){e.setRequestHeader(n,t)})),e.send(this.params)}},{key:"_getResponseHeaders",value:function(t){return t.getAllResponseHeaders().split("\n").filter((function(t){return 0===t.toLowerCase().indexOf("x-")}))}},{key:"_handleError",value:function(t,e,n){var r=this._createError(t,e,n);if(t.onreadystatechange=function(){},t.onerror=function(){},t.ontimeout=function(){},t.onabort=function(){},!(this.retryConfig.maxAttempts&&this._attemptCounter<this.retryConfig.maxAttempts))return this._requestPromise.reject(r);this._attemptCounter++,this._createXHR()}},{key:"_createError",value:function(t,e,n){return Object.assign(n,{url:this.url,headers:this._getResponseHeaders(t),attempt:this._attemptCounter}),new r.a(r.a.Severity.CRITICAL,r.a.Category.NETWORK,e,n)}}])&&i(e.prototype,n),s&&i(e,s),t}()},function(t,e,n){var r,o;
/*!
 * js-logger - http://github.com/jonnyreeves/js-logger
 * Jonny Reeves, http://jonnyreeves.co.uk/
 * js-logger may be freely distributed under the MIT license.
 */!function(i){"use strict";var a,s={};s.VERSION="1.6.0";var u={},c=function(t,e){return function(){return e.apply(t,arguments)}},f=function(){var t,e,n=arguments,r=n[0];for(e=1;e<n.length;e++)for(t in n[e])!(t in r)&&n[e].hasOwnProperty(t)&&(r[t]=n[e][t]);return r},l=function(t,e){return{value:t,name:e}};s.TRACE=l(1,"TRACE"),s.DEBUG=l(2,"DEBUG"),s.INFO=l(3,"INFO"),s.TIME=l(4,"TIME"),s.WARN=l(5,"WARN"),s.ERROR=l(8,"ERROR"),s.OFF=l(99,"OFF");var p=function(t){this.context=t,this.setLevel(t.filterLevel),this.log=this.info};p.prototype={setLevel:function(t){t&&"value"in t&&(this.context.filterLevel=t)},getLevel:function(){return this.context.filterLevel},enabledFor:function(t){var e=this.context.filterLevel;return t.value>=e.value},trace:function(){this.invoke(s.TRACE,arguments)},debug:function(){this.invoke(s.DEBUG,arguments)},info:function(){this.invoke(s.INFO,arguments)},warn:function(){this.invoke(s.WARN,arguments)},error:function(){this.invoke(s.ERROR,arguments)},time:function(t){"string"==typeof t&&t.length>0&&this.invoke(s.TIME,[t,"start"])},timeEnd:function(t){"string"==typeof t&&t.length>0&&this.invoke(s.TIME,[t,"end"])},invoke:function(t,e){a&&this.enabledFor(t)&&a(e,f({level:t},this.context))}};var y,h=new p({filterLevel:s.OFF});(y=s).enabledFor=c(h,h.enabledFor),y.trace=c(h,h.trace),y.debug=c(h,h.debug),y.time=c(h,h.time),y.timeEnd=c(h,h.timeEnd),y.info=c(h,h.info),y.warn=c(h,h.warn),y.error=c(h,h.error),y.log=y.info,s.setHandler=function(t){a=t},s.setLevel=function(t){for(var e in h.setLevel(t),u)u.hasOwnProperty(e)&&u[e].setLevel(t)},s.getLevel=function(){return h.getLevel()},s.get=function(t){return u[t]||(u[t]=new p(f({name:t},h.context)))},s.createDefaultHandler=function(t){(t=t||{}).formatter=t.formatter||function(t,e){e.name&&t.unshift("["+e.name+"]")};var e={},n=function(t,e){Function.prototype.apply.call(t,console,e)};return"undefined"==typeof console?function(){}:function(r,o){r=Array.prototype.slice.call(r);var i,a=console.log;o.level===s.TIME?(i=(o.name?"["+o.name+"] ":"")+r[0],"start"===r[1]?console.time?console.time(i):e[i]=(new Date).getTime():console.timeEnd?console.timeEnd(i):n(a,[i+": "+((new Date).getTime()-e[i])+"ms"])):(o.level===s.WARN&&console.warn?a=console.warn:o.level===s.ERROR&&console.error?a=console.error:o.level===s.INFO&&console.info?a=console.info:o.level===s.DEBUG&&console.debug?a=console.debug:o.level===s.TRACE&&console.trace&&(a=console.trace),t.formatter(r,o),n(a,r))}},s.useDefaults=function(t){s.setLevel(t&&t.defaultLevel||s.DEBUG),s.setHandler(s.createDefaultHandler(t))},void 0===(o="function"==typeof(r=s)?r.call(e,n,e,t):r)||(t.exports=o)}()},function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return i}));var r={DASH:{name:"dash",mimeType:"application/dash+xml",pathExt:"mpd"},HLS:{name:"hls",mimeType:"application/x-mpegURL",pathExt:"m3u8"},WVM:{name:"wvm",mimeType:"video/wvm",pathExt:"wvm"},MP4:{name:"mp4",mimeType:"video/mp4",pathExt:"mp4"},MP3:{name:"mp3",mimeType:"audio/mpeg",pathExt:"mp3"}},o=new Map([["mpegdash",r.DASH],["applehttp",r.HLS],["url",r.MP4]]);function i(t){var e=o.get(t);return!!e&&e.name===r.MP4.name}},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",(function(){return o}));var o=function t(e){var n,o,a;r(this,t),a=!1,(o="hasError")in(n=this)?Object.defineProperty(n,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[o]=a,"KalturaAPIException"===e.objectType?(this.hasError=!0,this.error=new i(e.code,e.message)):e.error&&"KalturaAPIException"===e.error.objectType?(this.hasError=!0,this.error=new i(e.error.code,e.error.message)):this.data=e},i=function t(e,n){r(this,t),this.code=e,this.message=n}},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r,o,i,a=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.scheme=e.scheme,this.licenseURL=e.licenseURL,this.certificate=e.certificate};i={"drm.PLAYREADY_CENC":"com.microsoft.playready","drm.WIDEVINE_CENC":"com.widevine.alpha","fairplay.FAIRPLAY":"com.apple.fairplay",WIDEVINE_CENC:"com.widevine.alpha",PLAYREADY_CENC:"com.microsoft.playready",FAIRPLAY:"com.apple.fairplay"},(o="Scheme")in(r=a)?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));n(9);var r=n(5);function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var i=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.progressive=[],this.dash=[],this.hls=[]}var e,n,i;return e=t,(n=[{key:"map",value:function(t,e){if(e)switch(e.name){case r.a.MP4.name:this.progressive.push(t);break;case r.a.DASH.name:this.dash.push(t);break;case r.a.HLS.name:this.hls.push(t)}}},{key:"toJSON",value:function(){var t={progressive:[],dash:[],hls:[]};return this.progressive.forEach((function(e){return t.progressive.push(e.toJSON())})),this.hls.forEach((function(e){return t.hls.push(e.toJSON())})),this.dash.forEach((function(e){return t.dash.push(e.toJSON())})),t}}])&&o(e.prototype,n),i&&o(e,i),t}()},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));n(13);function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,o;return e=t,(n=[{key:"toJSON",value:function(){var t={id:this.id,url:this.url,mimetype:this.mimetype};return this.bandwidth&&(t.bandwidth=this.bandwidth),this.width&&(t.width=this.width),this.height&&(t.height=this.height),this.label&&(t.label=this.label),this.drmData&&this.drmData.length>0&&(t.drmData=[],this.drmData.forEach((function(e){Array.isArray(t.drmData)&&t.drmData.push(e.toJSON())}))),t}}])&&r(e.prototype,n),o&&r(e,o),t}()},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));n(11);var r=n(0);function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var a=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,"_loadersResponseMap",new Map),i(this,"_loaders",new Map),this._networkRetryConfig=e}var e,n,a;return e=t,(n=[{key:"add",value:function(t,e){var n=this,r=new t(e);if(r.isValid()){this._loaders.set(t.id,r);var o=this._multiRequest.requests.length,i=r.requests;this._multiRequest.retryConfig=this._networkRetryConfig,i.forEach((function(t){n._multiRequest.add(t)}));var a=Array.from(new Array(i.length),(function(t,e){return e+o}));this._loadersResponseMap.set(t.id,a)}}},{key:"fetchData",value:function(){var t=this;return new Promise((function(e,n){t._multiRequest.execute().then((function(o){t._multiResponse=o.response,t.prepareData(o.response).success?e(t._loaders):n(new r.a(r.a.Severity.CRITICAL,r.a.Category.NETWORK,r.a.Code.API_RESPONSE_MISMATCH,{headers:o.headers}))}),(function(t){n(t)}))}))}},{key:"prepareData",value:function(t){var e=this;return this._loaders.forEach((function(n,r){var o=e._loadersResponseMap.get(r);try{o&&o.length>0&&(n.response=t.results.slice(o[0],o[o.length-1]+1))}catch(t){return{success:!1,error:t}}})),{success:!0,data:this._loaders}}}])&&o(e.prototype,n),a&&o(e,a),t}()},function(t,e,n){"use strict";n.d(e,"a",(function(){return v}));var r=n(3),o=n(1),i=n(6),a=n(0);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=h(t);if(e){var o=h(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p(this,n)}}function p(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?y(t):e}function y(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function d(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var v=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}(i,t);var e,n,r,o=l(i);function i(){var t;u(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return d(y(t=o.call.apply(o,[this].concat(n))),"requests",[]),t}return e=i,(n=[{key:"add",value:function(t){this.requests.push(t);var e={},n={service:t.service,action:t.action};return Object.assign(e,d({},this.requests.length,Object.assign(n,t.params))),Object.assign(e,this.params),this.params=e,this}},{key:"execute",value:function(){var t=this;return new Promise((function(e,n){try{t.params=JSON.stringify(t.params)}catch(e){i._logger.error("".concat(e.message)),n(new a.a(a.a.Severity.CRITICAL,a.a.Category.PROVIDER,a.a.Code.FAILED_PARSING_REQUEST,{error:e,params:t.params}))}t.doHttpRequest().then((function(r){var o=new b(r);o.success?e({headers:t.responseHeaders,response:o}):n(new a.a(a.a.Severity.CRITICAL,a.a.Category.NETWORK,a.a.Code.MULTIREQUEST_API_ERROR,{url:t.url,headers:t.responseHeaders,results:o.results}))}),(function(t){n(t)}))}))}}])&&c(e.prototype,n),r&&c(e,r),i}(r.a);d(v,"_logger",Object(o.b)("MultiRequestBuilder"));var b=function t(e){var n=this;u(this,t),d(this,"results",[]),this.success=!0,(e.result?e.result:e).forEach((function(e){var r=new i.a(e);if(n.results.push(r),r.hasError)return t._logger.error("Service returned an error with error code: ".concat(r.error.code," and message: ").concat(r.error.message,".")),void(n.success=!1)}))};d(b,"_logger",Object(o.b)("MultiRequestResult"))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.message=e.message,this.code=e.code}},function(t,e,n){"use strict";function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}n.d(e,"a",(function(){return o}));var o=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.licenseUrl=e,this.scheme=n,r&&(this.certificate=r)}var e,n,o;return e=t,(n=[{key:"toJSON",value:function(){var t={licenseUrl:this.licenseUrl,scheme:this.scheme};return this.certificate&&(t.certificate=this.certificate),t}}])&&r(e.prototype,n),o&&r(e,o),t}()},function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var r=n(1),o=(n(10),n(0));function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function a(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}var s=function(){function t(e,n){var o,i,a;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),a={async:!0,timeout:0,maxAttempts:4},(i="_networkRetryConfig")in(o=this)?Object.defineProperty(o,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[i]=a,this._partnerId=e.partnerId,this._widgetId=e.widgetId,this._uiConfId=e.uiConfId,this._isAnonymous=!e.ks,this._ks=e.ks||"",this._playerVersion=n,e.log&&e.log.level&&this.LogLevel[e.log.level]&&Object(r.e)(this.LogLevel[e.log.level]),e.log&&"function"==typeof e.log.handler&&Object(r.d)(e.log.handler)}return a(t,[{key:"partnerId",get:function(){return this._partnerId}},{key:"widgetId",get:function(){return this._widgetId||this.defaultWidgetId}},{key:"defaultWidgetId",get:function(){return"_"+this._partnerId}},{key:"uiConfId",get:function(){return this._uiConfId}},{key:"ks",get:function(){return this._ks},set:function(t){this._ks=t}},{key:"playerVersion",get:function(){return this._playerVersion}},{key:"isAnonymous",get:function(){return this._isAnonymous}}]),a(t,[{key:"getMediaConfig",value:function(t){return Promise.reject(new o.a(o.a.Severity.CRITICAL,o.a.Category.PROVIDER,o.a.Code.METHOD_NOT_IMPLEMENTED,{message:"getMediaConfig method must be implement by the derived class"}))}},{key:"getPlaylistConfig",value:function(t){return Promise.reject(new o.a(o.a.Severity.CRITICAL,o.a.Category.PROVIDER,o.a.Code.METHOD_NOT_IMPLEMENTED,{message:"The provider does not support loading playlist by id"}))}},{key:"getEntryListConfig",value:function(t){return Promise.reject(new o.a(o.a.Severity.CRITICAL,o.a.Category.PROVIDER,o.a.Code.METHOD_NOT_IMPLEMENTED,{message:"The provider does not support loading entry list"}))}},{key:"_verifyHasSources",value:function(t){if(0===t.hls.concat(t.dash,t.progressive).length)throw new o.a(o.a.Severity.CRITICAL,o.a.Category.SERVICE,o.a.Code.MISSING_PLAY_SOURCE,{action:"",messages:"No play source for entry id: ".concat(t.id)})}},{key:"getLogLevel",value:function(t){return Object(r.c)(t)}},{key:"setLogLevel",value:function(t,e){Object(r.e)(t,e)}},{key:"LogLevel",get:function(){return r.a}}]),t}()},function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}n.d(e,"a",(function(){return o}));var o=function t(e){var n;return Array.isArray(e)?(n=e.length>0?e.slice(0):[]).forEach((function(e,o){("object"===r(e)&&e!=={}||Array.isArray(e)&&e.length>0)&&(n[o]=t(e))})):"object"===r(e)?(n=Object.assign({},e),Object.keys(n).forEach((function(e){("object"===r(n[e])&&n[e]!=={}||Array.isArray(n[e])&&n[e].length>0)&&(n[e]=t(n[e]))}))):n=e,n}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));n(2);var r=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.items=[]}},function(t,e,n){"use strict";n.r(e),n.d(e,"Provider",(function(){return Ae})),n.d(e,"NAME",(function(){return De})),n.d(e,"VERSION",(function(){return Le}));var r=n(1),o=n(15);function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var a={serviceUrl:"https://cdnapisec.kaltura.com/api_v3",cdnUrl:"https://cdnapisec.kaltura.com",serviceParams:{apiVersion:"3.3.0",format:1},useApiCaptions:!0},s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,r;return e=t,r=[{key:"set",value:function(t){t&&Object.assign(a,t)}},{key:"get",value:function(){return Object(o.a)(a)}}],(n=null)&&i(e.prototype,n),r&&i(e,r),t}(),u=n(6),c=n(12),f=n(7);function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var p=function(){function t(e){var n,r,o,i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),o=[],(r="drm")in(n=this)?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,this.format=e.format,this.deliveryProfileId=e.deliveryProfileId,this.url=e.url,this.protocols=e.protocols,this.flavorIds=e.flavorIds,e.drm&&e.drm.map((function(t){return i.drm.push(new f.a(t))}))}var e,n,r;return e=t,(n=[{key:"hasDrmData",value:function(){return this.drm&&this.drm.length>0}},{key:"hasFlavorIds",value:function(){return!!this.flavorIds&&this.flavorIds.length>0}},{key:"getProtocol",value:function(t){var e="";if(this.protocols&&this.protocols.length>0)this.protocols.split(",").forEach((function(n){n===t&&(e=n)}));else if("http"===t)return t;return e}}])&&l(e.prototype,n),r&&l(e,r),t}();var y,h,d,v=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.type=e.type};function b(t){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t,e){return(m=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function g(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=_(t);if(e){var o=_(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return E(this,n)}}function E(t,e){return!e||"object"!==b(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function _(t){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}d={DRM_POLICY:"drm.DRM_POLICY",BLOCK:1,PREVIEW:2,LIMIT_FLAVORS:3,ADD_TO_STORAGE:4,LIMIT_DELIVERY_PROFILES:5,SERVE_FROM_REMOTE_SERVER:6,REQUEST_HOST_REGEX:7,LIMIT_THUMBNAIL_CAPTURE:8},(h="Type")in(y=v)?Object.defineProperty(y,h,{value:d,enumerable:!0,configurable:!0,writable:!0}):y[h]=d;var O=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&m(t,e)}(n,t);var e=g(n);function n(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(r=e.call(this,t)).pattern=t.pattern,r.replacement=t.replacement,r.replacmenServerNodeId=t.replacmenServerNodeId,r}return n}(v);var w=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=e.id,this.flavorParamsId=e.flavorParamsId,this.fileExt=e.fileExt,this.bitrate=e.bitrate,this.width=e.width,this.height=e.height,this.id=e.id,this.frameRate=e.frameRate,this.isOriginal=e.isOriginal,this.isWeb=e.isWeb,this.containerFormat=e.containerFormat,this.videoCodecId=e.videoCodecId,this.status=e.status,this.language=e.language,this.label=e.label};function R(t){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function I(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function T(t,e){return(T=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function P(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=k(t);if(e){var o=k(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return C(this,n)}}function C(t,e){return!e||"object"!==R(e)&&"function"!=typeof e?S(t):e}function S(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function k(t){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function j(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(w,"Status",{ERROR:-1,QUEUED:0,CONVERTING:1,READY:2,DELETED:3,NOT_APPLICABLE:4,TEMP:5,WAIT_FOR_CONVERT:6,IMPORTING:7,VALIDATING:8,EXPORTING:9});var A=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&T(t,e)}(i,t);var e,n,r,o=P(i);function i(t){var e;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),j(S(e=o.call(this,t)),"sources",[]),j(S(e),"actions",[]),j(S(e),"messages",[]),j(S(e),"flavorAssets",[]),!e.hasError){var n=t.messages;n&&n.map((function(t){return e.messages.push(new c.a(t))}));var r=t.actions;r&&r.map((function(t){t.type===v.Type.REQUEST_HOST_REGEX?e.actions.push(new O(t)):e.actions.push(new v(t))}));var a=t.sources;a&&a.map((function(t){return e.sources.push(new p(t))}));var s=t.flavorAssets;s&&s.map((function(t){return e.flavorAssets.push(new w(t))}))}return e}return e=i,(n=[{key:"hasBlockAction",value:function(){return void 0!==this.getBlockAction()}},{key:"getBlockAction",value:function(){return this.actions.find((function(t){return t.type===v.Type.BLOCK}))}},{key:"getErrorMessages",value:function(){return this.messages}},{key:"getRequestHostRegexAction",value:function(){var t=this.actions.find((function(t){return t.type===v.Type.REQUEST_HOST_REGEX}));if(t instanceof O)return t}}])&&I(e.prototype,n),r&&I(e,r),i}(u.a);function D(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var L=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=e.id,this.metadataProfileId=e.metadataProfileId,this.metadataProfileVersion=e.metadataProfileVersion,this.metadataProfileId=e.metadataProfileId,this.metadataObjectType=e.metadataObjectType,this.objectId=e.objectId,this.version=e.version,this.created=new Date(0),this.created.setUTCSeconds(e.createdAt),this.updated=new Date(0),this.updated.setUTCSeconds(e.updatedAt),this.status=e.status,this.xml=e.xml};function M(t){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function N(t,e){return(N=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function x(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=F(t);if(e){var o=F(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return U(this,n)}}function U(t,e){return!e||"object"!==M(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function F(t){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}D(L,"ObjectType",{AD_CUE_POINT:"adCuePointMetadata.AdCuePoint",ANNOTATION:"annotationMetadata.Annotation",CODE_CUE_POINT:"codeCuePointMetadata.CodeCuePoint",THUMB_CUE_POINT:"thumbCuePointMetadata.thumbCuePoint",ENTRY:1,CATEGORY:2,USER:3,PARTNER:4,DYNAMIC_OBJECT:5}),D(L,"Status",{VALID:1,INVALID:2,DELETED:3});var V=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&N(t,e)}(n,t);var e=x(n);function n(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(r=e.call(this,t)).hasError||(r.totalCount=t.totalCount,r.totalCount>0&&(r.metas=[],t.objects.map((function(t){return r.metas.push(new L(t))})))),r}return n}(u.a);function q(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var H=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=e.id,this.referenceId=e.referenceId,this.externalSourceType=e.externalSourceType,this.name=e.name,this.description=e.description,this.dataUrl=e.dataUrl,this.type=e.type,this.entryType=e.mediaType,this.flavorParamsIds=e.flavorParamsIds,this.duration=e.duration,this.poster=e.thumbnailUrl,this.status=e.status,this.dvrStatus=e.dvrStatus,this.tags=e.tags};function B(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}q(H,"EntryType",{AUTOMATIC:{value:-1},EXTERNAL_MEDIA:{value:"externalMedia.externalMedia"},MEDIA_CLIP:{value:1},MIX:{value:2},PLAYLIST:{value:5},DATA:{value:6},LIVE_STREAM:{value:7},LIVE_CHANNEL:{value:8},DOCUMENT:{value:10}}),q(H,"MediaType",{VIDEO:{value:1},IMAGE:{value:2},AUDIO:{value:5},LIVE_STREAM_FLASH:{value:201},LIVE_STREAM_WINDOWS_MEDIA:{value:202},LIVE_STREAM_REAL_MEDIA:{value:203},LIVE_STREAM_QUICK_TIME:{value:204}}),q(H,"EntryStatus",{ERROR_IMPORTING:-2,ERROR_CONVERTING:-1,SCAN_FAILURE:"virusScan.ScanFailure",IMPORT:0,INFECTED:"virusScan.Infected",PRECONVERT:1,READY:2,DELETED:3,PENDING:4,MODERATE:5,BLOCKED:6,NO_CONTENT:7}),q(H,"EntryModerationStatus",{PENDING_MODERATION:1,APPROVED:2,REJECTED:3,FLAGGED_FOR_REVIEW:4,MODERATE:5,AUTO_APPROVED:6});var W=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,r;return e=t,r=[{key:"build",value:function(t){var e=s.get(),n=e.serviceUrl.substr(0,e.serviceUrl.lastIndexOf("/")),r=t.partnerId,o=t.entryId,i=t.ks,a=t.uiConfId,u=t.format,c=t.protocol,f=t.extension,l=t.flavorIds;if(!(n&&r&&o&&u&&c))return"";var p=n;return n.endsWith("/")||(p+="/"),p+="p/"+r+"/sp/"+r+"00/playManifest/entryId/"+o+"/protocol/"+c+"/format/"+u,l?p+="/flavorIds/"+l:a&&(p+="/uiConfId/"+a),""!==i&&(p+="/ks/"+i),""!==f&&(p+="/a."+f),a&&""!==l&&(p+="?uiConfId="+a),p}}],(n=null)&&B(e.prototype,n),r&&B(e,r),t}();function G(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Y=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,r;return e=t,r=[{key:"xmlToJson",value:function(t){var e={};if(1===t.nodeType){if(t.attributes.length>0){e["@attributes"]={};for(var n=0;n<t.attributes.length;n++){var r=t.attributes.item(n);e["@attributes"][r.nodeName]=r.nodeValue}}}else 3===t.nodeType&&(e=t.nodeValue);if(t.hasChildNodes())for(var o=0;o<t.childNodes.length;o++){var i=t.childNodes.item(o),a=i.nodeName;if(void 0===e[a])e[a]=this.xmlToJson(i);else{if(void 0===e[a].push){var s=e[a];e[a]=[],e[a].push(s)}e[a].push(this.xmlToJson(i))}}return e}}],(n=null)&&G(e.prototype,n),r&&G(e,r),t}(),K=n(2),J=n(13),X=n(9),Q=n(8),z=n(5);var Z=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.items=[]},$=n(16);function tt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var et={SRT:"1",DFXP:"2",WEBVTT:"3",CAP:"4"},nt={3:"vtt",1:"srt"},rt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,r;return e=t,r=[{key:"createConfig",value:function(t){return t.map((function(t){var e=t.url,n=nt[t.format];return[et.DFXP,et.CAP].includes(t.format)&&(e=t.webVttUrl,n=nt[et.WEBVTT]),{default:!!t.isDefault,type:n,language:t.languageCode,label:t.label,url:e}}))}}],(n=null)&&tt(e.prototype,n),r&&tt(e,r),t}();function ot(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var it=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,r;return e=t,r=[{key:"getMediaEntry",value:function(e,n,r,o){var i=new K.a,a=o.entry,u=o.playBackContextResult,c=o.metadataListResult,f=u.sources;return i.sources=t._getParsedSources(f,e,n,r,a,u),s.get().useApiCaptions&&u.data.playbackCaptions&&(i.sources.captions=rt.createConfig(u.data.playbackCaptions)),t._fillBaseData(i,a,c),i}},{key:"getPlaylist",value:function(e){var n=new Z,r=e.playlistData,o=e.playlistItems.entries;return n.id=r.id,n.name=r.name,n.description=r.description,n.poster=r.poster,o.forEach((function(e){var r=new K.a;t._fillBaseData(r,e),n.items.push(r)})),n}},{key:"getEntryList",value:function(e){var n=new $.a;return e.playlistItems.entries.forEach((function(e){var r=new K.a;t._fillBaseData(r,e),n.items.push(r)})),n}},{key:"_fillBaseData",value:function(e,n,r){return e.poster=n.poster,e.id=n.id,e.duration=n.duration,e.metadata=t._parseMetadata(r),e.metadata.description=n.description||"",e.metadata.name=n.name||"",e.metadata.tags=n.tags||"",e.status=n.status,e.type=t._getEntryType(n.entryType,n.type),e.type===K.a.Type.LIVE&&(e.dvrStatus=n.dvrStatus),e}},{key:"_getEntryType",value:function(t,e){var n=K.a.Type.UNKNOWN;switch(t){case H.MediaType.IMAGE.value:n=K.a.Type.IMAGE;break;case H.MediaType.AUDIO.value:n=K.a.Type.AUDIO;break;default:switch(e){case H.EntryType.MEDIA_CLIP.value:n=K.a.Type.VOD;break;case H.EntryType.LIVE_STREAM.value:case H.EntryType.LIVE_CHANNEL.value:n=K.a.Type.LIVE;break;default:n=K.a.Type.UNKNOWN}}return n}},{key:"_getParsedSources",value:function(e,n,r,o,i,a){var s,u,c=new Q.a,f=function(e){var s=t._parseAdaptiveSource(e,a,n,r,o,i.id);if(s){var u=z.b.get(e.format);c.map(s,u)}};return i.type===H.EntryType.EXTERNAL_MEDIA.value?((u=new X.a).mimetype="video/youtube",u.url=i.referenceId,u.id=i.id+"_youtube",c.progressive.push(u)):e&&e.length>0&&(e.filter((function(t){return!Object(z.c)(t.format)})).forEach(f),s=e.find((function(e){return Object(z.c)(e.format)&&""!==e.getProtocol(t._getBaseProtocol())})),c.progressive=t._parseProgressiveSources(s,a,n,r,o,i.id)),c}},{key:"_parseAdaptiveSource",value:function(e,n,r,o,i,a){var s=new X.a;if(e){var u="",c=z.b.get(e.format),l=e.getProtocol(t._getBaseProtocol()),p=e.deliveryProfileId,y=e.format,h="";if(c&&(h=c.pathExt,s.mimetype=c.mimeType),e.hasFlavorIds()?(!h&&n.flavorAssets&&n.flavorAssets.length>0&&(h=n.flavorAssets[0].fileExt),u=W.build({entryId:a,flavorIds:e.flavorIds,format:y,ks:r,partnerId:o,uiConfId:i,extension:h,protocol:l})):u=e.url,!u){var d="failed to create play url from source, discarding source: (".concat(a,"_").concat(p,"), ").concat(y);return t._logger.warn(d),null}if(s.url=t._applyRegexAction(n,u),s.id=a+"_"+p+","+y,e.hasDrmData()){var v=[];e.drm.forEach((function(t){v.push(new J.a(t.licenseURL,f.a.Scheme[t.scheme],t.certificate))})),s.drmData=v}}return s}},{key:"_parseProgressiveSources",value:function(e,n,r,o,i,a){var s=[],u=[];if(e){var c=e.getProtocol(t._getBaseProtocol()),f=e.format,l=e.deliveryProfileId,p=l+","+f;n.flavorAssets.map((function(e){var y=new X.a;y.id=e.id+p,y.mimetype="mp3"===e.fileExt?"audio/mp3":"video/mp4",y.height=e.height,y.width=e.width,y.bandwidth=1024*e.bitrate,y.label=e.label||e.language;var h=W.build({entryId:a,flavorIds:e.id,format:f,ks:r,partnerId:o,uiConfId:i,extension:e.fileExt,protocol:c});if(""===h)return t._logger.warn("failed to create play url from source, discarding source: (".concat(a,"_").concat(l,"), ").concat(f,".")),null;y.url=t._applyRegexAction(n,h),e.height&&e.width?s.push(y):u.push(y)}))}return u.length&&!s.length?u:s}},{key:"_parseMetadata",value:function(t){var e={};return t&&t.metas&&t.metas.length>0&&t.metas.forEach((function(t){var n,r=new DOMParser;t.xml=t.xml.replace(/\r?\n|\r/g,""),t.xml=t.xml.replace(/>\s*/g,">"),t.xml=t.xml.replace(/>\s*/g,">"),n=r.parseFromString(t.xml,"text/xml");var o=Y.xmlToJson(n);Object.keys(o.metadata).forEach((function(t){e[t]=o.metadata[t]["#text"]}))})),e}},{key:"_getBaseProtocol",value:function(){var t=s.get(),e=/^https?:/.exec(t.cdnUrl),n=e?e[0]:document.location.protocol;return"string"==typeof n?n.slice(0,-1):"https"}},{key:"hasBlockAction",value:function(t){return t.playBackContextResult.hasBlockAction()}},{key:"getBlockAction",value:function(t){return t.playBackContextResult.getBlockAction()}},{key:"getErrorMessages",value:function(t){return t.playBackContextResult.getErrorMessages()}},{key:"_applyRegexAction",value:function(t,e){var n=t.getRequestHostRegexAction();if(n){var r=new RegExp(n.pattern,"i");if(e.match(r))return e.replace(r,n.replacement+"/")}return e}}],(n=null)&&ot(e.prototype,n),r&&ot(e,r),t}();!function(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(it,"_logger",Object(r.b)("OVPProviderParser"));var at=n(3),st=n(11);function ut(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var ct=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,r;return e=t,r=[{key:"getMultiRequest",value:function(t,e,n){var r=s.get(),o=r.serviceParams;Object.assign(o,{ks:e,clientTag:"html5:v"+t}),n&&Object.assign(o,{partnerId:n});var i=new Map;i.set("Content-Type","application/json");var a=new st.a(i);return a.method="POST",a.service="multirequest",a.url=a.getUrl(r.serviceUrl),a.params=o,a}}],(n=null)&&ut(e.prototype,n),r&&ut(e,r),t}();function ft(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var lt="id,referenceId,name,description,thumbnailUrl,dataUrl,duration,msDuration,flavorParamsIds,mediaType,type,tags,dvrStatus,externalSourceType,status",pt=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ft(this,t),this.type=e.type||t.Type.INCLUDE_FIELDS,this.fields=e.fields||lt};function yt(t){return(yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ht(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function dt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function vt(t,e){return(vt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function bt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=gt(t);if(e){var o=gt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return mt(this,n)}}function mt(t,e){return!e||"object"!==yt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function gt(t){return(gt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}!function(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(pt,"Type",{INCLUDE_FIELDS:1,EXCLUDE_FIELDS:2});var Et=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&vt(t,e)}(i,t);var e,n,r,o=bt(i);function i(){return ht(this,i),o.apply(this,arguments)}return e=i,r=[{key:"getPlaybackContext",value:function(t,e){var n=new Map,r="{1:result:ks}"===e?"{2:result:objects:0:id}":"{1:result:objects:0:id}";n.set("Content-Type","application/json");var o=new at.a(n);return o.service="baseEntry",o.action="getPlaybackContext",o.method="POST",o.url=o.getUrl(t),o.tag="baseEntry-getPlaybackContext",o.params={entryId:r,ks:e,contextDataParams:{objectType:"KalturaContextDataParams",flavorTags:"all"}},o}},{key:"list",value:function(t,e,n,r){var o=new Map;o.set("Content-Type","application/json");var a=new at.a(o);return a.service="baseEntry",a.action="list",a.method="POST",a.url=a.getUrl(t),a.tag="list",a.params=i.getEntryListReqParams(n,e,r),a}},{key:"getEntryListReqParams",value:function(t,e,n){return{ks:e,filter:n?{redirectFromEntryId:t}:{idEqual:t},responseProfile:new pt}}}],(n=null)&&dt(e.prototype,n),r&&dt(e,r),i}(ct);function _t(t){return(_t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ot(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function wt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Rt(t,e){return(Rt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function It(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Pt(t);if(e){var o=Pt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Tt(this,n)}}function Tt(t,e){return!e||"object"!==_t(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Pt(t){return(Pt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ct=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Rt(t,e)}(i,t);var e,n,r,o=It(i);function i(){return Ot(this,i),o.apply(this,arguments)}return e=i,r=[{key:"list",value:function(t,e,n){var r=new Map;r.set("Content-Type","application/json");var o=new at.a(r);o.service="metadata_metadata",o.action="list",o.method="POST",o.url=o.getUrl(t),o.tag="metadata_metadata-list";var i={objectType:"KalturaMetadataFilter",objectIdEqual:n,metadataObjectTypeEqual:"1"};return o.params={filter:i,ks:e},o}}],(n=null)&&wt(e.prototype,n),r&&wt(e,r),i}(ct);function St(t){return(St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function kt(t,e){return(kt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function jt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Dt(t);if(e){var o=Dt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return At(this,n)}}function At(t,e){return!e||"object"!==St(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Dt(t){return(Dt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Lt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&kt(t,e)}(n,t);var e=jt(n);function n(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(r=e.call(this,t)).hasError||(r.totalCount=t.totalCount,r.totalCount>0&&(r.entries=[],t.objects.map((function(t){return r.entries.push(new H(t))})))),r}return n}(u.a);function Mt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Nt(t,e,n){return e&&Mt(t.prototype,e),n&&Mt(t,n),t}var xt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(this,"_response",{}),this.requests=this.buildRequests(e),this._entryId=e.entryId}return Nt(t,null,[{key:"id",get:function(){return"media"}}]),Nt(t,[{key:"buildRequests",value:function(t){var e=s.get(),n=[];return n.push(Et.list(e.serviceUrl,t.ks,t.entryId,t.redirectFromEntryId)),n.push(Et.getPlaybackContext(e.serviceUrl,t.ks)),n.push(Ct.list(e.serviceUrl,t.ks,t.entryId)),n}},{key:"isValid",value:function(){return!!this._entryId}},{key:"requests",set:function(t){this._requests=t},get:function(){return this._requests}},{key:"response",set:function(t){var e=new Lt(t[0].data);this._response.entry=e.entries[0],this._response.playBackContextResult=new A(t[1].data),this._response.metadataListResult=new V(t[2].data)},get:function(){return this._response}}]),t}();function Ut(t){return(Ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ft(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Vt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function qt(t,e){return(qt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ht(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Wt(t);if(e){var o=Wt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Bt(this,n)}}function Bt(t,e){return!e||"object"!==Ut(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Wt(t){return(Wt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Gt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&qt(t,e)}(i,t);var e,n,r,o=Ht(i);function i(){return Ft(this,i),o.apply(this,arguments)}return e=i,r=[{key:"anonymousSession",value:function(t,e){var n=new Map;n.set("Content-Type","application/json");var r=new at.a(n);return r.service="session",r.action="startWidgetSession",r.method="POST",r.url=r.getUrl(t),r.tag="session-startWidget",r.params={widgetId:e},r}}],(n=null)&&Vt(e.prototype,n),r&&Vt(e,r),i}(ct);function Yt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Kt(t,e,n){return e&&Yt(t.prototype,e),n&&Yt(t,n),t}var Jt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(this,"_response",{}),this.requests=this.buildRequests(e),this._widgetId=e.widgetId}return Kt(t,[{key:"requests",set:function(t){this._requests=t},get:function(){return this._requests}},{key:"response",set:function(t){this._response.ks=t[0].data.ks},get:function(){return this._response.ks}}],[{key:"id",get:function(){return"session"}}]),Kt(t,[{key:"buildRequests",value:function(t){var e=s.get(),n=[];return n.push(Gt.anonymousSession(e.serviceUrl,t.widgetId)),n}},{key:"isValid",value:function(){return!!this._widgetId}}]),t}();function Xt(t){return(Xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Qt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function zt(t,e){return(zt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Zt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=te(t);if(e){var o=te(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return $t(this,n)}}function $t(t,e){return!e||"object"!==Xt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function te(t){return(te=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ee=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&zt(t,e)}(n,t);var e=Zt(n);function n(t,r){var o,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3?arguments[3]:void 0;return Qt(this,n),(o=e.call(this,a))._multiRequest=ct.getMultiRequest(t,i,r),o}return n}(n(10).a);function ne(t){return(ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function re(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function oe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ie(t,e){return(ie=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ae(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ue(t);if(e){var o=ue(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return se(this,n)}}function se(t,e){return!e||"object"!==ne(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ue(t){return(ue=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ce=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ie(t,e)}(i,t);var e,n,r,o=ae(i);function i(){return re(this,i),o.apply(this,arguments)}return e=i,r=[{key:"execute",value:function(t,e,n){var r=new Map;r.set("Content-Type","application/json");var o=new at.a(r);return o.service="playlist",o.action="execute",o.method="POST",o.url=o.getUrl(t),o.tag="".concat("playlist","-execute"),o.params={ks:e,id:n,responseProfile:new pt},o}},{key:"get",value:function(t,e,n){var r=new Map;r.set("Content-Type","application/json");var o=new at.a(r);return o.service="playlist",o.action="get",o.method="POST",o.url=o.getUrl(t),o.tag="".concat("playlist","-get"),o.params={ks:e,id:n,responseProfile:{fields:"id,name,description,thumbnailUrl",type:1}},o}}],(n=null)&&oe(e.prototype,n),r&&oe(e,r),i}(ct);var fe=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=e.id,this.name=e.name,this.description=e.description,this.poster=e.thumbnailUrl};function le(t){return(le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pe(t,e){return(pe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ye(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=de(t);if(e){var o=de(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return he(this,n)}}function he(t,e){return!e||"object"!==le(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function de(t){return(de=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ve=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&pe(t,e)}(n,t);var e=ye(n);function n(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(r=e.call(this,t)).hasError||(r.entries=[],t.map((function(t){return r.entries.push(new H(t))}))),r}return n}(u.a);function be(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function me(t,e,n){return e&&be(t.prototype,e),n&&be(t,n),t}var ge=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(this,"_response",{}),this.requests=this.buildRequests(e),this._playlistId=e.playlistId}return me(t,null,[{key:"id",get:function(){return"playlist"}}]),me(t,[{key:"buildRequests",value:function(t){var e=s.get(),n=[];return n.push(ce.get(e.serviceUrl,t.ks,t.playlistId)),n.push(ce.execute(e.serviceUrl,t.ks,t.playlistId)),n}},{key:"isValid",value:function(){return!!this._playlistId}},{key:"requests",set:function(t){this._requests=t},get:function(){return this._requests}},{key:"response",set:function(t){this._response.playlistData=new fe(t[0].data),this._response.playlistItems=new ve(t[1].data)},get:function(){return this._response}}]),t}(),Ee=n(14);function _e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Oe(t,e,n){return e&&_e(t.prototype,e),n&&_e(t,n),t}var we=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(this,"_response",{playlistItems:{entries:[]}}),this.requests=this.buildRequests(e),this._entries=e.entries}return Oe(t,null,[{key:"id",get:function(){return"entry_list"}}]),Oe(t,[{key:"buildRequests",value:function(t){var e=s.get(),n=[];return t.entries.forEach((function(r){n.push(Et.list(e.serviceUrl,t.ks,r.entryId||r,t.redirectFromEntryId))})),n}},{key:"isValid",value:function(){return!(!this._entries||!this._entries.length)}},{key:"requests",set:function(t){this._requests=t},get:function(){return this._requests}},{key:"response",set:function(t){var e,n=this;t.forEach((function(t){e=new Lt(t.data),n._response.playlistItems.entries.push(e.entries[0])}))},get:function(){return this._response}}]),t}(),Re=n(0);function Ie(t){return(Ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Te(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Pe(t,e){return(Pe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ce(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=je(t);if(e){var o=je(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Se(this,n)}}function Se(t,e){return!e||"object"!==Ie(e)&&"function"!=typeof e?ke(t):e}function ke(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function je(t){return(je=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ae=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Pe(t,e)}(a,t);var e,n,o,i=Ce(a);function a(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),function(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(ke(n=i.call(this,t,e)),"_filterOptionsConfig",{redirectFromEntryId:!0}),n._logger=Object(r.b)("OVPProvider"),s.set(t.env),n._setFilterOptionsConfig(t.filterOptions),n._networkRetryConfig=Object.assign(n._networkRetryConfig,t.networkRetryParameters),n}return e=a,(n=[{key:"getMediaConfig",value:function(t){var e=this;return t.ks&&(this.ks=t.ks,this._isAnonymous=!1),this.widgetId!==this.defaultWidgetId&&(this._isAnonymous=!1),this._dataLoader=new ee(this.playerVersion,this.partnerId,this.ks,this._networkRetryConfig),new Promise((function(n,r){var o=t.entryId;if(o){var i=e.ks;i||(i="{1:result:ks}",e._dataLoader.add(Jt,{widgetId:e.widgetId}));var a=e._getEntryRedirectFilter(t);return e._dataLoader.add(xt,{entryId:o,ks:i,redirectFromEntryId:a}),e._dataLoader.fetchData().then((function(t){try{n(e._parseDataFromResponse(t))}catch(t){r(t)}}),(function(t){r(t)}))}r(new Re.a(Re.a.Severity.CRITICAL,Re.a.Category.PROVIDER,Re.a.Code.MISSING_MANDATORY_PARAMS,{message:"missing entry id"}))}))}},{key:"_getEntryRedirectFilter",value:function(t){return"boolean"==typeof t.redirectFromEntryId?t.redirectFromEntryId:"boolean"!=typeof this._filterOptionsConfig.redirectFromEntryId||this._filterOptionsConfig.redirectFromEntryId}},{key:"_setFilterOptionsConfig",value:function(t){t&&"boolean"==typeof t.redirectFromEntryId&&(this._filterOptionsConfig.redirectFromEntryId=t.redirectFromEntryId)}},{key:"_parseDataFromResponse",value:function(t){this._logger.debug("Data parsing started");var e={session:{isAnonymous:this._isAnonymous,partnerId:this.partnerId},sources:this._getDefaultSourcesObject(),plugins:{}};if(this.uiConfId&&(e.session.uiConfId=this.uiConfId),t){if(t.has(Jt.id)){var n=t.get(Jt.id);n&&n.response&&(e.session.ks=n.response,this.widgetId!==this.defaultWidgetId&&(this.ks=e.session.ks))}else e.session.ks=this.ks;if(t.has(xt.id)){var r=t.get(xt.id);if(r&&r.response){var o=r.response;if(it.hasBlockAction(o))throw new Re.a(Re.a.Severity.CRITICAL,Re.a.Category.SERVICE,Re.a.Code.BLOCK_ACTION,{action:it.getBlockAction(o),messages:it.getErrorMessages(o)});var i=it.getMediaEntry(this.isAnonymous?"":this.ks,this.partnerId,this.uiConfId,o);Object.assign(e.sources,this._getSourcesObject(i)),this._verifyMediaStatus(i),this._verifyHasSources(e.sources)}}}return this._logger.debug("Data parsing finished",e),e}},{key:"_verifyMediaStatus",value:function(t){if([H.EntryStatus.IMPORT,H.EntryStatus.PRECONVERT].includes(t.status))throw new Re.a(Re.a.Severity.CRITICAL,Re.a.Category.SERVICE,Re.a.Code.MEDIA_STATUS_NOT_READY,{messages:"Status of entry id ".concat(t.id," is ").concat(t.status," and is still being imported or converted"),data:{status:status}})}},{key:"getPlaylistConfig",value:function(t){var e=this;return t.ks&&(this.ks=t.ks,this._isAnonymous=!1),this.widgetId!==this.defaultWidgetId&&(this._isAnonymous=!1),this._dataLoader=new ee(this.playerVersion,this.partnerId,this.ks,this._networkRetryConfig),new Promise((function(n,r){var o=t.playlistId;if(o){var i=e.ks;i||(i="{1:result:ks}",e._dataLoader.add(Jt,{widgetId:e.widgetId})),e._dataLoader.add(ge,{playlistId:o,ks:i}),e._dataLoader.fetchData().then((function(t){n(e._parsePlaylistDataFromResponse(t))}),(function(t){r(t)}))}else r({success:!1,data:"Missing mandatory parameter"})}))}},{key:"_parsePlaylistDataFromResponse",value:function(t){var e=this;this._logger.debug("Data parsing started");var n=this._getPlaylistObject();if(t&&t.has(ge.id)){var r=t.get(ge.id);if(r&&r.response){var o=it.getPlaylist(r.response);n.id=o.id,n.poster=o.poster,n.metadata.name=o.name,n.metadata.description=o.description,o.items.forEach((function(t){return n.items.push({sources:e._getSourcesObject(t)})}))}}return this._logger.debug("Data parsing finished",n),n}},{key:"getEntryListConfig",value:function(t){var e=this;return t.ks&&(this.ks=t.ks,this._isAnonymous=!1),this.widgetId!==this.defaultWidgetId&&(this._isAnonymous=!1),this._dataLoader=new ee(this.playerVersion,this.partnerId,this.ks,this._networkRetryConfig),new Promise((function(n,r){var o=t.entries;if(o&&o.length){var i=e.ks;i||(i="{1:result:ks}",e._dataLoader.add(Jt,{widgetId:e.widgetId}));var a=e._getEntryRedirectFilter(t);e._dataLoader.add(we,{entries:o,ks:i,redirectFromEntryId:a}),e._dataLoader.fetchData().then((function(t){n(e._parseEntryListDataFromResponse(t))}),(function(t){r(t)}))}else r({success:!1,data:"Missing mandatory parameter"})}))}},{key:"_parseEntryListDataFromResponse",value:function(t){var e=this;this._logger.debug("Data parsing started");var n=this._getPlaylistObject();if(t&&t.has(we.id)){var r=t.get(we.id);r&&r.response&&it.getEntryList(r.response).items.forEach((function(t){return n.items.push({sources:e._getSourcesObject(t)})}))}return this._logger.debug("Data parsing finished",n),n}},{key:"_getPlaylistObject",value:function(){return{id:"",metadata:{name:"",description:""},poster:"",items:[]}}},{key:"_getDefaultSourcesObject",value:function(){return{hls:[],dash:[],progressive:[],id:"",duration:0,type:K.a.Type.UNKNOWN,poster:"",dvr:!1,vr:null,metadata:{name:"",description:"",tags:""}}}},{key:"_getSourcesObject",value:function(t){var e=this._getDefaultSourcesObject(),n=t.sources.toJSON();return e.hls=n.hls,e.dash=n.dash,e.progressive=n.progressive,e.id=t.id,e.duration=t.duration,e.type=t.type,e.dvr=!!t.dvrStatus,e.poster=t.poster,t.sources.captions&&(e.captions=t.sources.captions),t.metadata&&"string"==typeof t.metadata.tags&&t.metadata.tags.indexOf("360")>-1&&(e.vr={}),Object.assign(e.metadata,t.metadata),e}}])&&Te(e.prototype,n),o&&Te(e,o),a}(Ee.a),De="playkit-js-providers-ovp",Le="2.21.1"}])}));
//# sourceMappingURL=playkit-ovp-provider.js.map